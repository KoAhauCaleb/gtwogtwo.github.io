<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Conways Game Of Life</h1>
    <p id="speedOut">Speed: </p>
    <input type="range" min="1" max="500" value="0" class="slider" id="speed"> 
    <div> 
        <canvas id="myCanvas" width="400" height="400" ></canvas>
    </div>  
</body>
<script>
    
var speed = 50;
var slider = document.getElementById("speed");
slider.oninput = function() {
    speed = this.value;
    document.getElementById("speedOut").innerText = "Speed: " + (speed - 1)
}

var c = document.getElementById("myCanvas");
var ctx = c.getContext("2d");

function drawCells(cells){
    for(var i = 0; i < 20; i++){
        for(var j = 0; j < 19; j++){
            if (cells[i][j] == 0){
                ctx.fillStyle = "#000000";
                ctx.fillRect(j * 20, i * 20, 20, 20);
            }
            else if (cells[i][j] == 0){
                ctx.fillStyle = "#ffffff";
                ctx.fillRect(j * 20, i * 20, 20, 20);
            }
        }
    }
}

function calcCells(cells){
    ctx.clearRect(0, 0, 400, 400);
    let newCells = JSON.parse(JSON.stringify(cells));
    for(var i = 0; i < 20; i++){
        for(var j = 0; j < 20; j++){
            
            var liveSuroundingCellCount = 0;
            
            if(i < 19 && cells[i+1][j] == 1){
                liveSuroundingCellCount++;
            }
            if(i > 0 && cells[i-1][j] == 1){
                liveSuroundingCellCount++;
            }
            if(j < 19 && cells[i][j+1] == 1){
                liveSuroundingCellCount++;
            }
            if(j > 0 && cells[i][j-1] == 1){
                liveSuroundingCellCount++;
            }
            if(i < 19 && j < 19 && cells[i+1][j+1] == 1){
                liveSuroundingCellCount++;
            }
            if(i > 0 && j > 0 && cells[i-1][j-1] == 1){
                liveSuroundingCellCount++;
            }
            if(i < 19 && j > 0 && cells[i+1][j-1] == 1){
                liveSuroundingCellCount++;
            }
            if(i > 0 && j < 19 && cells[i-1][j+1] == 1){
                liveSuroundingCellCount++;
            }
            
            if(cells[i][j] == 0 && (liveSuroundingCellCount == 2 || liveSuroundingCellCount == 3)){
                newCells[i][j] = 1;
            }
            else if (cells[i][j] == 1 && liveSuroundingCellCount != 3){
                newCells[i][j] = 0;
            }
        }
    }
    return JSON.parse(JSON.stringify(newCells));
}

function sleep(ms){ 
    //code written by Dan Dascalescu on stackoverflow.com
    return new Promise(resolve => setTimeout(resolve, ms));
}

async function main(){
    var cells = [
        
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,1,0,1,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
    ]

    while (true){
        if(speed > 1){
            cells = calcCells(cells);
            console.log(cells);
            drawCells(cells);
            await sleep(700-speed);
        }
        await sleep(1);
    }
}

main();
</script>
</html>
